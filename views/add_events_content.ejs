<div class="container my-5">
    <h2 class="mb-4 text-center">Add Event</h2>

    <!-- Search Event Templates -->
    <h4>Select an Event Template</h4>

    <input type="text" id="templateSearchInput" placeholder="Search event templates..." class="form-control mb-2">

    <!-- Scrollable Template Table -->
    <div style="max-height: 250px; overflow-y: auto;">
        <table class="table table-bordered" id="templateTable">
            <thead>
                <tr>
                    <th>Event ID</th>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Description</th>
                    <th>Recurrence</th>
                    <th>Default Capacity</th>
                </tr>
            </thead>
            <tbody>
                <% eventTemplates.forEach(t => { %>
                    <tr onclick="chooseTemplate('<%= t.Event_ID %>')" style="cursor:pointer;">
                        <td>
                            <%= t.Event_ID %>
                        </td>
                        <td>
                            <%= t.EventName %>
                        </td>
                        <td>
                            <%= t.EventType %>
                        </td>
                        <td>
                            <%= t.EventDescription %>
                        </td>
                        <td>
                            <%= t.EventRecurrencePattern %>
                        </td>
                        <td>
                            <%= t.EventDefaultCapacity %>
                        </td>
                    </tr>
                    <% }) %>
            </tbody>
        </table>
    </div>

    <hr class="my-4">

    <!-- Add Event Form -->
    <form action="/events/add" method="POST">

        <div class="mb-3">
            <label class="form-label">Event Template ID</label>
            <input type="text" id="templateID" name="Event_ID" class="form-control" placeholder="Select a template from the table above" required>
        </div>

        <div class="mb-3">
            <label class="form-label">Event Start Date & Time</label>
            <input type="datetime-local" name="EventDateTimeStart" class="form-control" required>
        </div>

        <div class="mb-3">
            <label class="form-label">Event End Date & Time</label>
            <input type="datetime-local" name="EventDateTimeEnd" class="form-control" required>
        </div>

        <div class="mb-3">
            <label class="form-label">Location</label>
            <input type="text" name="EventLocation" class="form-control" required>
        </div>

        <div class="mb-3">
            <label class="form-label">Capacity</label>
            <input type="number" name="EventCapacity" class="form-control" placeholder="Enter event capacity" required>
        </div>

        <div class="mb-3">
            <label class="form-label">Registration Deadline</label>
            <input type="datetime-local" name="EventRegistrationDeadline" class="form-control" required>
        </div>

        <button class="custom-btn">Submit</button>
        <a href="/events" class="custom-btn ms-3">Cancel</a>
    </form>
</div>

<script>
    // Fill event template ID from table click
    function chooseTemplate(id) {
        document.getElementById("templateID").value = id;
    }

    // Search filter logic
    const templateSearchInput = document.getElementById("templateSearchInput");

    if (templateSearchInput) {
        templateSearchInput.addEventListener("input", function() {
            const filter = this.value.toLowerCase();
            const rows = document.querySelectorAll("#templateTable tbody tr");

            rows.forEach(row => {
                const text = row.innerText.toLowerCase();
                row.style.display = text.includes(filter) ? "" : "none";
            });
        });
    }
</script>