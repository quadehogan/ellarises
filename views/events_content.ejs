<div class="container mt-5">
    <h2 class="mb-4 text-center">Events</h2>

    <% if ((upcomingEvents && upcomingEvents.length > 0) || (pastEvents && pastEvents.length > 0)) { %>

        <!-- Search bar -->
        <div class="mb-3">
            <input type="text" id="eventSearchInput" class="form-control" placeholder="Search events by any field">
        </div>

        <!-- Upcoming Events Table -->
        <% if (upcomingEvents && upcomingEvents.length > 0) { %>
            <h4 class="mb-2">Upcoming Events</h4>
            <div style="max-height: 400px; overflow-y: auto;">
                <table class="table table-striped table-bordered" id="eventTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Type</th>
                            <th>Date</th>
                            <th>Location</th>
                            <th>Edit</th>
                            <th>Delete</th>
                            <th>Survey</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% upcomingEvents.forEach(event => { %>
                            <tr>
                                <td>
                                    <%= event.EventName %>
                                </td>
                                <td>
                                    <%= event.EventType %>
                                </td>
                                <td>
                                    <%= new Date(event.EventDateTimeStart).toLocaleString() %>
                                </td>
                                <td>
                                    <%= event.EventLocation %>
                                </td>

                                <!-- EDIT BUTTON -->
                                <td>
                                    <a href="/events/edit/<%= event.Event_ID %>/<%= encodeURIComponent(event.EventDateTimeStart) %>" class="custom-btn">
                                        Edit
                                    </a>
                                </td>

                                <!-- DELETE BUTTON -->
                                <td>
                                    <form action="/events/delete/<%= event.Event_ID %>/<%= encodeURIComponent(event.EventDateTimeStart) %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this event?');" style="display:inline-block;">

                                        <button type="submit" class="custom-btn" style="padding: 0.25rem 0.5rem; font-size: 0.85rem;">
                                            Delete
                                        </button>

                                    </form>
                                </td>

                                <!-- SURVEY -->
                                <td>
                                    <a href="/surveys/<%= event.Event_ID %>/<%= encodeURIComponent(new Date(event.EventDateTimeStart).toISOString()) %>" class="custom-btn">
                                        Survey
                                    </a>
                                </td>
                            </tr>
                            <% }) %>
                    </tbody>
                </table>
            </div>

            <!-- ADD EVENT BUTTON -->
            <a href="/events/add" class="custom-btn mt-3">Add Event</a>

            <% } %>

                <!-- Past Events Table -->
                <% if (pastEvents && pastEvents.length > 0) { %>
                    <h4 class="mt-4 mb-2">Past Events</h4>
                    <div style="max-height: 400px; overflow-y: auto;">
                        <table class="table table-striped table-bordered" id="pastEventTable">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Date</th>
                                    <th>Location</th>
                                    <th>Edit</th>
                                    <th>Delete</th>
                                    <th>Survey</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% pastEvents.forEach(event => { %>
                                    <tr>
                                        <td>
                                            <%= event.EventName %>
                                        </td>
                                        <td>
                                            <%= event.EventType %>
                                        </td>
                                        <td>
                                            <%= new Date(event.EventDateTimeStart).toLocaleString() %>
                                        </td>
                                        <td>
                                            <%= event.EventLocation %>
                                        </td>

                                        <!-- EDIT BUTTON -->
                                        <td>
                                            <a href="/events/edit/<%= event.Event_ID %>/<%= encodeURIComponent(event.EventDateTimeStart) %>" class="custom-btn">
                                        Edit
                                    </a>
                                        </td>

                                        <!-- DELETE BUTTON -->
                                        <td>
                                            <form action="/events/delete/<%= event.Event_ID %>/<%= encodeURIComponent(event.EventDateTimeStart) %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this event?');" style="display:inline-block;">

                                                <button type="submit" class="custom-btn" style="padding: 0.25rem 0.5rem; font-size: 0.85rem;">
                                            Delete
                                        </button>

                                            </form>
                                        </td>

                                        <!-- SURVEY -->
                                        <td>
                                            <a href="/surveys/<%= event.Event_ID %>/<%= encodeURIComponent(new Date(event.EventDateTimeStart).toISOString()) %>" class="custom-btn">
                                        Survey
                                    </a>
                                        </td>
                                    </tr>
                                    <% }) %>
                            </tbody>
                        </table>
                    </div>
                    <% } %>

                        <% } else { %>
                            <div class="alert alert-info text-center">No events available.</div>
                            <% } %>
</div>

<script>
    const eventSearchInput = document.getElementById('eventSearchInput');

    if (eventSearchInput) {
        eventSearchInput.addEventListener('keyup', function() {
            const filter = this.value.toLowerCase();
            const rows = document.querySelectorAll('#eventTable tbody tr');
            const pastRows = document.querySelectorAll('#pastEventTable tbody tr');

            [...rows, ...pastRows].forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(filter) ? '' : 'none';
            });
        });
    }
</script>