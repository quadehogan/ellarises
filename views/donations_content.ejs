<div class="container mt-5">

  <h2 class="mb-4 text-center">Donations Info</h2>

  <% if (donations && donations.length > 0) { %>

    <!-- Search bar -->
    <div class="mb-3">
      <input type="text" id="donationSearchInput" class="form-control" placeholder="Search donations by any field">
    </div>

    <div style="max-height: 400px; overflow-y: auto;">
      <table class="table table-striped table-bordered" id="donationTable">
        <thead>
          <% if (user.role === 'admin') { %>
          <tr>
            <th>Donation ID</th>
            <th>Participant ID</th>
            <th>Donor Name</th>
            <th>Amount</th>
            <th>Date</th>
          </tr>
          <% } else { %>
          <tr>
            <th>Donation ID</th>
            <th>Amount</th>
            <th>Date</th>
          </tr>
          <% } %>
        </thead>
        <tbody>
          <% donations.forEach(d => { %>
            <tr>
              <% if (user.role === 'admin') { %>
              <td><%= d.Donation_ID %></td>
              <td><%= d.Participant_ID %></td>
              <td><%= d.FirstName %> <%= d.LastName %></td>
              <td>$<%= Number(d.DonationAmount).toFixed(2) %></td>
              <td><%= d.DonationDate %></td>
              <% } else { %>
              <td><%= d.Donation_ID %></td>
              <td>$<%= Number(d.DonationAmount).toFixed(2) %></td>
              <td><%= d.DonationDate %></td>
              <% } %>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>

    <h4 class="mt-3 text-end">
      <% if (user.role === 'admin') { %>
        Total Donations: $<%= totalAmount.toFixed(2) %>
      <% } else { %>
        Total Donated: $<%= totalAmount.toFixed(2) %>
      <% } %>
    </h4>

    <% if (user.role === 'participant') { %>
      <form action="/donate" method="GET" class="mt-3">
        <button type="submit" class="btn btn-primary w-100">Submit New Donation</button>
      </form>
    <% } %>

  <% } else { %>
    <div class="alert alert-info text-center">No donations available.</div>
  <% } %>
</div>

<!-- Client-side search script -->
<script>
  const donationSearchInput = document.getElementById('donationSearchInput');
  if (donationSearchInput) {
    donationSearchInput.addEventListener('keyup', function() {
      const filter = this.value.toLowerCase();
      const rows = document.querySelectorAll('#donationTable tbody tr');

      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(filter) ? '' : 'none';
      });
    });
  }
</script>
