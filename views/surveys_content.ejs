<div class="container mt-5">
    <!-- Event Header -->
    <h2>
        <%= event.EventName %> â€” Surveys</h2>
    <p class="text-muted">
        <strong>Date:</strong>
        <%= event.EventDateTimeStart.toLocaleString() %><br>
            <strong>Overall Score:</strong>
            <%= averages.overall %>
    </p>

    <!-- Averages Table -->
    <table class="table table-bordered mt-4">
        <thead>
            <tr>
                <th>Satisfaction score</th>
                <th>Usefulness score</th>
                <th>Instructor score</th>
                <th>Recommendation score</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>
                    <%= averages.satisfaction %>
                </td>
                <td>
                    <%= averages.usefulness %>
                </td>
                <td>
                    <%= averages.instructor %>
                </td>
                <td>
                    <%= averages.recommendation %>
                </td>
            </tr>
        </tbody>
    </table>

    <!-- Survey Cards -->
    <div class="row mt-4">

        <% surveys.forEach(s => { %>
            <div class="col-md-4 mb-4">
                <div class="card survey-card" data-satisfaction="<%= s.SurveySatisfactionScore %>" data-usefulness="<%= s.SurveyUsefulnessScore %>" data-instructor="<%= s.SurveyInstructorScore %>" data-recommendation="<%= s.SurveyRecommendationScore %>" data-comments="<%= s.SurveyComments %>"
                    data-date="<%= s.SurveySubmissionDate.toLocaleString() %>">

                    <div class="card-body">
                        <h5 class="card-title">
                            <%= s.ParticipantFirstName %>
                                <%= s.ParticipantLastName %>
                        </h5>
                        <p class="card-text">
                            <strong>Overall Score:</strong>
                            <%= s.SurveyOverallScore %><br>
                                <strong>NPS Bucket:</strong>
                                <%= s.SurveyNPSBucket %>
                        </p>
                    </div>
                </div>
            </div>
            <% }) %>

    </div>
</div>

<!-- Hover Popup Styles -->
<style>
    .survey-card {
        position: relative;
        cursor: pointer;
        transition: box-shadow 0.2s ease-in-out;
    }
    
    .survey-card:hover {
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
    }
    
    .survey-tooltip {
        position: absolute;
        z-index: 999;
        background: white;
        padding: 12px;
        border: 1px solid #ccc;
        border-radius: 6px;
        width: 260px;
        font-size: 0.9rem;
        display: none;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }
</style>

<!-- Hover Details Script -->
<script>
    document.querySelectorAll('.survey-card').forEach(card => {
        const tooltip = document.createElement('div');
        tooltip.className = 'survey-tooltip';
        tooltip.innerHTML = `
            <strong>Satisfaction:</strong> ${card.dataset.satisfaction}<br>
            <strong>Usefulness:</strong> ${card.dataset.usefulness}<br>
            <strong>Instructor:</strong> ${card.dataset.instructor}<br>
            <strong>Recommendation:</strong> ${card.dataset.recommendation}<br>
            <strong>Comments:</strong> ${card.dataset.comments || 'None'}<br>
            <strong>Submission Date:</strong> ${card.dataset.date}
        `;
        card.appendChild(tooltip);

        card.addEventListener('mouseenter', () => {
            tooltip.style.display = 'block';
        });
        card.addEventListener('mouseleave', () => {
            tooltip.style.display = 'none';
        });
        card.addEventListener('mousemove', (e) => {
            tooltip.style.left = (e.offsetX + 20) + 'px';
            tooltip.style.top = (e.offsetY + 20) + 'px';
        });
    });
</script>