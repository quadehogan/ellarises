<div class="survey-page">

    <!-- Event Header -->
    <h1>
        <%= event.EventName %>
    </h1>

    <p class="event-date">
        <strong>Date:</strong>
        <%= new Date(event.EventDateTimeStart).toLocaleString() %>
    </p>

    <!-- Add Survey Button (Admin or Manager) -->
    <% if (user.role === "admin") { %>
        <div class="my-3">
            <a href="/add_survey/<%= user.id %>/<%= event.Event_ID %>/<%= encodeURIComponent(event.EventDateTimeStart.toISOString()) %>" class="custom-btn">
                Add Survey
            </a>
        </div>
        <% } %>

            <!-- Overall Score -->
            <h2>Overall Score:
                <%= averages.overall %>
            </h2>

            <!-- Averages Table -->
            <table class="averages-table">
                <thead>
                    <tr>
                        <th>Satisfaction</th>
                        <th>Usefulness</th>
                        <th>Instructor</th>
                        <th>Recommendation</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <%= averages.satisfaction %>
                        </td>
                        <td>
                            <%= averages.usefulness %>
                        </td>
                        <td>
                            <%= averages.instructor %>
                        </td>
                        <td>
                            <%= averages.recommendation %>
                        </td>
                    </tr>
                </tbody>
            </table>

            <hr>

<h2>Survey Submissions</h2>

    <div class="survey-cards-container">

  <% surveys.forEach(s => { %>
    <div class="survey-card" 
         data-satisfaction="<%= s.SurveySatisfactionScore %>" 
         data-usefulness="<%= s.SurveyUsefulnessScore %>" 
         data-instructor="<%= s.SurveyInstructorScore %>" 
         data-recommendation="<%= s.SurveyRecommendationScore %>" 
         data-comments="<%= s.SurveyComments || 'No comments' %>"
         data-date="<%= new Date(s.SurveySubmissionDate).toLocaleString() %>">

      <h3>
        <%= s.ParticipantFirstName %> <%= s.ParticipantLastName %>
      </h3>
      <p><strong>Overall Score:</strong> <%= s.SurveyOverallScore %></p>
      <p><strong>NPS Bucket:</strong> <%= s.SurveyNPSBucket %></p>

      <!-- Delete button at the bottom of the card -->
        <form 
            action="/survey/<%= s.Participant_ID %>/<%= s.Event_ID %>/<%= encodeURIComponent(s.EventDateTimeStart) %>/delete" 
            method="POST" 
            onsubmit="return confirm('Are you sure you want to delete this survey?');"
            style="margin-top: auto; text-align: center;"
            >
            <button type="submit" class="custom-btn" style="padding: 0.25rem 0.5rem; font-size: 0.85rem;">
                Delete
            </button>
        </form>

        <!-- Edit button for a survey -->
        <a href="/survey/<%= s.Participant_ID %>/<%= s.Event_ID %>/<%= encodeURIComponent(s.EventDateTimeStart) %>/edit" class="custom-btn" style="margin-top: 0.5rem; padding: 0.25rem 0.5rem; font-size: 0.85rem;">
            Edit
        </a>
    </div>
  <% }) %>

</div>


</div>

<!-- Tooltip Styles -->
<style>
    .survey-card {
        background: #ffffff;
        padding: 16px;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.18);
        width: 240px;
        display: inline-block;
        margin: 10px;
        position: relative;
        transition: transform 0.15s ease-in-out;
        cursor: pointer;
    }
    
    .survey-card:hover {
        transform: translateY(-3px);
    }
    
    .tooltip-box {
        display: none;
        position: absolute;
        top: 105%;
        left: 50%;
        transform: translateX(-50%);
        background: #f9f9f9;
        padding: 12px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.25);
        width: 260px;
        z-index: 10;
    }
    
    .survey-card:hover .tooltip-box {
        display: block;
    }
</style>

<!-- Tooltip Builder Script -->
<script>
    document.querySelectorAll('.survey-card').forEach(card => {
        const tooltip = document.createElement('div');
        tooltip.classList.add('tooltip-box');

        tooltip.innerHTML = `
            <strong>Satisfaction:</strong> ${card.dataset.satisfaction}<br>
            <strong>Usefulness:</strong> ${card.dataset.usefulness}<br>
            <strong>Instructor:</strong> ${card.dataset.instructor}<br>
            <strong>Recommendation:</strong> ${card.dataset.recommendation}<br>
            <strong>Comments:</strong> ${card.dataset.comments}<br>
            <strong>Submitted:</strong> ${card.dataset.date}
        `;

        card.appendChild(tooltip);
    });
</script>