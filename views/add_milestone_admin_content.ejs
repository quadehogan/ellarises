<h2 class="mb-4">Add Milestone (Admin)</h2>

<form action="/milestone/add/admin" method="POST">

    <!-- Selected participant -->
    <div class="mb-3">
        <label class="form-label">Selected Participant ID</label>
        <input type="text" id="participantID" name="Participant_ID" class="form-control" placeholder="Click a participant below…" required readonly>
    </div>

    <!-- Title -->
    <div class="mb-3">
        <label class="form-label">Milestone Title</label>
        <input type="text" name="MilestoneTitle" class="form-control" required>
    </div>

    <!-- Date -->
    <div class="mb-3">
        <label class="form-label">Milestone Date</label>
        <input type="date" name="MilestoneDate" class="form-control" required>
    </div>

    <button class="custom-btn mt-3">Add Milestone</button>
    <a href="/manage_dashboard?view=milestones" class="btn btn-secondary ms-3">Cancel</a>

</form>

<hr class="my-4">

<h3>Select Participant</h3>

<!-- Search Box -->
<div class="mb-3">
    <input type="text" id="searchInput" class="form-control" placeholder="Search participants…">
</div>

<!-- Participant Table -->
<div style="max-height: 350px; overflow-y: auto;">
    <table class="table table-striped" id="participantsTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
            </tr>
        </thead>
        <tbody>
            <% participants.forEach(p => { %>
                <tr style="cursor:pointer;" onclick="chooseParticipant('<%= p.Participant_ID %>')">
                    <td>
                        <%= p.Participant_ID %>
                    </td>
                    <td>
                        <%= p.ParticipantFirstName %>
                            <%= p.ParticipantLastName %>
                    </td>
                    <td>
                        <%= p.ParticipantEmail %>
                    </td>
                </tr>
                <% }) %>
        </tbody>
    </table>
</div>

<script>
    // ✔ Fill participant ID when a row is clicked
    function chooseParticipant(id) {
        document.getElementById("participantID").value = id;
    }

    // ✔ Search filter
    const searchInput = document.getElementById("searchInput");
    if (searchInput) {
        searchInput.addEventListener("input", function() {
            const filter = this.value.toLowerCase();
            const rows = document.querySelectorAll("#participantsTable tbody tr");

            rows.forEach(row => {
                const text = row.innerText.toLowerCase();
                row.style.display = text.includes(filter) ? "" : "none";
            });
        });
    }
</script>